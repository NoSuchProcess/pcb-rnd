print [@
PLUGDIR=../src_plugins

CFLAGS=-I.. -I../src_3rd -DSCMDIR="\"$(LIBDIR)\""
LDFLAGS=
EXE=@sys/ext_exe@
CC=@cc/cc@

HASHOBJ=../src_3rd/liblihata/genht/hash.o ../src_3rd/liblihata/genht/htsp.o
VECTOBJ=../src_3rd/genvector/genvector.a
LISTOBJ=../src_3rd/genlist/genlist.a
SCCFOBJ=../scconfig/src/default/str.o
QPARSE=../src_3rd/qparse/qparse.o
@]

put /local/pcb/tmpasm/buildin  {../src_plugins/Buildin.tmpasm}
put /local/pcb/tmpasm/plugin   {../src_plugins/Plugin.tmpasm}
put /local/pcb/tmpasm/disable  {../src_plugins/Disable.tmpasm}

put /local/pcb/RULES {}
put /local/pcb/OBJS {}
put /local/pcb/LDFLAGS {}
put /local/pcb/CFLAGS {}

include {../src_plugins/plugins_fp.tmpasm}

print [@

FP_OBJS    = @/local/pcb/OBJS@ ../src/plug_footprint.o
FP_LDFLAGS = @/local/pcb/LDFLAGS@
FP_CFLAGS  = @/local/pcb/CFLAGS@

gsch2pcb-rnd$(EXE): gsch2pcb.o ../src/compat_fs.o ../src/paths.o $(HASHOBJ) $(VECTOBJ) $(LISTOBJ) $(SCCFOBJ) $(QPARSE) $(FP_OBJS)
	$(CC) gsch2pcb.o  ../src/compat_fs.o ../src/paths.o $(HASHOBJ) $(VECTOBJ) $(LISTOBJ) $(SCCFOBJ) $(QPARSE) $(FP_OBJS) -o gsch2pcb-rnd$(EXE) $(LDFLAGS) $(FP_LDFLAGS)

gsch2pcb.o: gsch2pcb.c ../config.h  ../config.manual.h  ../config.auto.h
	$(CC) -c $(CFLAGS) $(FP_CFLAGS) gsch2pcb.c -o gsch2pcb.o

$(HASHOBJ):
	cd ../src_3rd/liblihata/genht && make

$(VECTOBJ):
	cd ../src_3rd/genvector && make

$(LISTOBJ):
	cd ../src_3rd/genlist && make

$(QPARSE):
	cd ../src_3rd/qparse && make

##### module rules begin #####
@/local/pcb/RULES@
##### module rules end #####
@]

# generate explicit rules for .c -> .o
put /local/comp/OBJS /local/pcb/OBJS
include {../scconfig/Makefile.comp.inc}

print [@

install_:
	$(MKDIR) "$(BINDIR)" "$(LIBDIR)"
	$(CPC) "`pwd`/gsch2pcb-rnd$(EXE)" "$(BINDIR)/gsch2pcb-rnd$(EXE)"
	$(CPC) "`pwd`/fp2anim" "$(BINDIR)/fp2anim"
	$(CPC) "`pwd`/gnet-gsch2pcb-rnd.scm" "$(LIBDIR)/gnet-gsch2pcb-rnd.scm"

install:
	make install_ CPC="$(CP)"

linstall:
	make install_ CPC="$(LN)"

uninstall:
	$(RM) "$(BINDIR)/gsch2pcb-rnd$(EXE)"
	$(RM) "$(BINDIR)/fp2anim"
	$(RM) "$(LIBDIR)/gnet-gsch2pcb-rnd.scm"


clean:
	$(RM) gsch2pcb-rnd$(EXE) gsch2pcb.o

include ../Makefile.conf

@]
