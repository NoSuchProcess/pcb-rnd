<!DOCTYPE html>
<html lang="en">
<head>
<title>Route style GUI design</title>
</head>
<body >
<div id="header">
<h1>Route style GUI design</h1>
<div >
<span id="author" >Alain</span><br>
</div>
<div id="content">
<div >
<h2 id="_abstract">Abstract</h2>
<div >
<div >
<p>This document is a WIP, working document, mixture of many sources of documentation
linked to the <a href="#img-gtk2_gui">Route Style</a> GUI part, as presented to the user.</p>
</div>
</div>
</div>
<div >
<h2 id="_introduction">1. Introduction</h2>
<div >
<div >
<h3 id="_what_is_a_route_style">1.1. What is a Route Style</h3>
<div >
<p>The <code><span ><span >Edit</span> / <span >Route Styles</span></span></code> menu allows you to select a style which is a group
of line thickness, via diameter, via drill size, and clearance (keepaway)
(collectively called a <em>routing style</em>) to be copied to the <em>active</em> sizes.
You can also change the names given to the routing styles and adjust their
values from <code><span ><span >Edit</span> / <span >Route Styles</span> / <span >Edit</span></span></code> menu.</p>
</div>
<div >
<p>The active sizes are also adjustable from this menu (How ?).
The active sizes are shown in the status-line and control the initial size of
new vias, drilling holes, lines, clearances, text-objects and also
the maximum dimensions of the board layout.</p>
</div>
<div >
<p>A routing style can be attributed to a net. (How ?, How am I sure all the
nets/lines/tracks are affected to the selected routing style ?)</p>
</div>
</div>
<div >
<h3 id="_using_the_autorouter">1.2. Using the autorouter</h3>
<div >
<p>Do we still have the autorouter ? Is what is described next working elsewhere ?</p>
</div>
<div >
<p>Use routing styles in the netlist to have per-net routing styles.
Note that the routing style will be used for an entire net.
This means if you have a wide metal setting for a power net you will need to
manually route breakouts from any fine pitch parts on their power pins because
the router will not be able to change to a narrow trace to connect to the part.</p>
</div>
</div>
</div>
</div>
<div >
<h2 id="_design_intentions">2. Design intentions</h2>
<div >
<div >
<h3 id="__code_pcb_rnd_code_goals">2.1. <code>pcb-rnd</code> goals</h3>
<div >
<ul>
<li>
<p>Alleviate the limitation of 4 only different route styles.</p>
</li>
<li>
<p>Keep track of "current" route style</p>
</li>
</ul>
</div>
</div>
<div >
<h3 id="__code_pcb_rnd_code_implementation_prior_1_2_1">2.2. <code>pcb-rnd</code> implementation prior 1.2.1</h3>
<div >
<p>A radio-button area + extra <a href="#img-gtk2-edit_route">dialog</a></p>
</div>
<div >
<h4 id="_add_a_new_route_style">2.2.1. Add a new route style</h4>
<div >
<p>This is ensured via the <code>&lt;New&gt;</code> selection</p>
</div>
<div id="img-gtk2-edit_route" >
<div >
<img src="gtk2-edit_route_styles_001.png" alt="gtk2 edit route styles 001">
</div>
<div >Figure 1. Edit route styles dialog</div>
</div>
<div >
<p>Q: No <code>Add</code> button: historical reasons. The original code in mainline
has 4 route styles, hardwired. It can not remove styles.
We inherited the mechanism of adding style by selecting the <code>&lt;New&gt;</code>.
(In mainline if you add styles more than 4, they are lost on save).</p>
</div>
<div >
<p>The inherited code tries not to do modifications immediately but only when
you close the window. This is a common pattern in the gtk hid at the
moment: all data from core copied to some "hid_gtk-specific" mirror cache
for the dialog, then the dialog works on the cache and it is copied back
when you close the dialog.</p>
</div>
<div >
<p>Igor2 thinks the idea was that the dialogs are modal and if the user says
cancel, you just don't do the copy-back. It's a lot of extra code and complication.
The strange &lt;new style&gt; mechanism might be a result of this: the dialog-cache
is probably not smart enough to hold multiple new styles, but with
the current mechanism you can add only one new style until you close the dialog.</p>
</div>
</div>
<div >
<h4 id="_keep_track_of_current_route_style">2.2.2. Keep track of current route style</h4>
<div >
<p>This is ensured via the <code>&lt;custom&gt;</code> selection in <a href="#img-gtk2-edit_route">dialog</a>.</p>
</div>
<div >
<p>At the end you are not drawing with the selected style, you are drawing
with a pen. When you change style, all parameters of the style
are copied into the pen. However, you can change any parameter of
the pen with hotkeys, which means you can easily end up drawing with a pen
that does not match any of the currently existing styles.</p>
</div>
<div >
<p>Mainline has this too, it's all inherited.</p>
</div>
<div >
<p>Using such a custom pen is useful when you want to draw a
single net of some special geometry - it is not worth adding a
new style, but you may still want to set the temporary pen up properly.</p>
</div>
<div >
<p>The problem was that when you used such a custom pen, you didn't really
have a way to see your current setting and besides the <code>add +5 mils</code> kind of
hotkeys, you couldn't really set it up, e.g.
"I want 80 mil wide traces temporarily"
was hard to do. So I introduced the <code>&lt;current&gt;</code> style, which shows the current
settings of the pen so it is not hidden anymore.</p>
</div>
<div >
<table>
<tr>
<td >
<i  title="Note"></i>
</td>
<td >
Lapsus here from Igor, who really means &lt;current&gt;. I suggest to rename it &lt;current&gt; ??
</td>
</tr>
</table>
</div>
<div >
<p>This way you can see and change all parameters of the pen, without having to
create a new style or having to use CLI actions.</p>
</div>
<div >
<p>Igor2 definitely wants to keep <code>&lt;custom&gt;</code> in the gtk2 hid, wants to add it in the
lesstif hid and wants all new GUI hids to support it the same way.</p>
</div>
<div >
<p><code>&lt;current&gt;</code> mode is indicated by not selecting any style (no radio button selected).
As long as your pen matches any of the existing style, you are drawing with
that style and the style is marked in the radio button.
When you change your pen to something that doesn't match any existing style,
the radio button turns off.</p>
</div>
<div >
<p>This is by design, Igor2 likes it, miloh, with whom we coded it likes it too.
Please do not change this.</p>
</div>
<div >
<p>But the pen concept exists there too: press <span ><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>V</kbd></span>, it will change
the via drill size of the pen. This will result in a pen not matching
any existing style - radio button selection disappears.</p>
</div>
</div>
</div>
<div >
<div >
<h2 id="_gtk2_situation">3. GTK2 situation</h2>
<div >
<div >
<h3 id="_user_manual">3.1. User manual</h3>
<div >
<p>Document this part. Most of the info are above. Select and create a section.
See FIXME.</p>
</div>
<div >
<p>Especially, document <code>Attributes</code></p>
</div>
<div >
<ul>
<li>
<p>what for ?</p>
</li>
<li>
<p>expected key, values ?</p>
</li>
<li>
<p>format ? units ?</p>
</li>
</ul>
</div>
<div id="img-gtk2_gui" >
<div >
<img src="gtk2-pcb-rnd_001.png" alt="gtk2 pcb rnd 001">
</div>
<div >Figure 2. <code>pcb-rnd</code> on an empty design, with Edit Route Style dialog open</div>
</div>
<div >
<table>
<tr>
<td >
<i  title="Important"></i>
</td>
<td >
Where is <code>saved "as default"</code> ? Documentation here ?
</td>
</tr>
</table>
</div>
</div>
<div >
<h3 id="_short_term_improvements">3.2. Short-term improvements ?</h3>
<div >
<p>This seems to be low priority w.r.t. cairo and GTK3... Am I right ?</p>
</div>
</div>
</div>
</div>
<div >
<h2 id="_gtk3_design_proposal">4. GTK3 design proposal</h2>
<div >
<div >
<p>TODO: A mock-up (screenshot)</p>
</div>
<div >
<p>A <code>GtkTreeView</code>, allowing the direct rename of style, allow sorting, or drag
and drop the styles to change order.</p>
</div>
<div >
<p>Can be selected (highlighted) to show the active route style.</p>
</div>
<div >
<p><code>GtkButtonBox</code> with usual buttons : Add, Delete, Raise, Down</p>
</div>
<div >
<p>Still another dialog is needed for other infos</p>
</div>
</div>
</div>
<div >
<h2 id="_gtk2_retro_fit">5. GTK2 retro-fit ?</h2>
<div >
<div >
<p>If so, then trade for a less advanced GtkTreeView</p>
</div>
<div >
<p><code>GtkHButtonBox</code> i.s.o <code>GtkButtonBox</code>.</p>
</div>
</div>
</div>
</div>
</body>
</html>
