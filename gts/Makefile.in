put /local/gts/CFLAGS [@-I.. -DG_LOG_DOMAIN=\"Gts\" @libs/sul/glib/cflags@@]
put /local/gts/OBJS [@
	object.o
	point.o
	vertex.o
	segment.o
	edge.o
	triangle.o
	face.o
	kdtree.o
	bbtree.o
	misc.o
	predicates.o
	heap.o
	eheap.o
	fifo.o
	matrix.o
	surface.o
	stripe.o
	vopt.o
	refine.o
	iso.o
	isotetra.o
	split.o
	psurface.o
	hsurface.o
	cdt.o
	boolean.o
	named.o
	oocs.o
	container.o
	graph.o
	pgraph.o
	partition.o
	curvature.o
	tribox3.o
@]

put /tmpasm/OFS { }
uniq /local/gts/OBJS
put /local/gts/SRCS /local/gts/OBJS
gsub /local/gts/SRCS {.o } {.c }

print [@
CFLAGS = @/local/gts/CFLAGS@

OBJS = @/local/gts/OBJS@

libgts.a: $(OBJS)
	@fstools/ar@ rvu libgts.a $(OBJS)

clean:
	-@fstools/rm@ $(OBJS) libgts.a

### explicit rules for .c -> .o ###
@]

foreach /local/o in /local/gts/OBJS
put /local/c /local/o
sub /local/c {.o$} {.c}
print [@
@/local/o@: @/local/c@
	$(CC) -c $(CFLAGS) -o @/local/o@ $<
@]
end

print [@

### generate dependencies (requires gcc) ###
FORCE:

include Makefile.dep

dep: FORCE
	echo "### Generated file, do not edit, run make dep ###" > Makefile.dep
	echo "" >> Makefile.dep
@]

put /local/cf /local/gts/CFLAGS
gsub /local/cf {-I} {-isystem }
foreach /local/c in /local/gts/SRCS
	print [@	gcc -MM @/local/c@ @/local/cf@ >> Makefile.dep
@]
end

