#!/usr/bin/make -f
#                                          -*- makefile -*-
# debian/rules file for the Debian/GNU Linux pcb package
# Copyright 1997-99 by Hartmut Koptein <koptein@debian.org>
# Copyright 2016 by Tibor 'Igor2' Palinkas <pcb-rnd[removethis]@igor2.repo.hu>

package = pcb-rnd

# A few plugins are so important that we rather build them into the core
# executable:
PCB_RND_BUILTINS = \
 --buildin-hid_batch \
 --buildin-fp_fs \
 --buildin-import_netlist \
 --buildin-import_sch \
 --buildin-io_pcb \
 --buildin-io_lihata \
 --disable-io_kicad_legacy \
 --plugin-io_kicad \
 --buildin-draw_fab

CONFIGURE_OPTS=--symbols --all=plugin $(PCB_RND_BUILTINS) --prefix=/usr --LDFLAGS=-Wl,-z,relro --disable-bison

%:
	dh $@

override_dh_auto_configure:
	./configure $(CONFIGURE_OPTS)

override_dh_auto_build:
	make

override_dh_auto_test:
#	dh_auto_test --builddirectory build_gtk
#	dh_auto_test --builddirectory build_lesstif

override_dh_auto_install:
	make install install_root=`pwd`/debian/tmp

override_dh_auto_clean:
	-make distclean

override_dh_install:
	dh_install
	mkdir -p debian/$(package)-core/usr/share/pixmaps
	cp debian/pcb-rnd.xpm debian/$(package)-core/usr/share/pixmaps/pcb-rnd.xpm

	# Set executable bit for pcb tools:
#	-[ ! -d debian/$(package)-gtk ] || chmod a+x debian/$(package)-gtk/usr/lib/pcb-rnd/plugins/hid_gtk.so

override_dh_fixperms:
	dh_fixperms -X usr/lib/pcb-rnd/plugins/

override_dh_installexamples:
	dh_installexamples -XMakefile

override_dh_installchangelogs:
	dh_installchangelogs -p$(package)-core

override_dh_installdocs:
	# Only install docs in $(package)-core & link other packages' docs to
	# $(package)-core:
	dh_installdocs --link-doc=$(package)-core

override_dh_compress:
	# exclude example files from compression
	dh_compress -X.pcb
